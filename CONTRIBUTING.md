# Contributing to COBridge

Thank you for your interest in contributing to COBridge! We welcome contributions of all kinds -- bug reports, feature requests, documentation improvements, and code changes.

---

## Code of Conduct

Be kind. Be respectful. We are all here to build something useful together.

- Treat every contributor with courtesy and respect, regardless of experience level.
- Focus on constructive feedback. Critique ideas, not people.
- Assume good intent. If something seems unclear, ask for clarification.
- Harassment, discrimination, and abusive behaviour will not be tolerated.

---

## How to Report Bugs

Found a bug? Please open a [GitHub issue](https://github.com/anthropics/cobridge/issues/new) with the following information:

### Bug Report Template

```
**Describe the bug**
A clear and concise description of the issue.

**To reproduce**
Steps to reproduce the behaviour:
1. ...
2. ...
3. ...

**Expected behaviour**
What you expected to happen.

**Actual behaviour**
What actually happened. Include any error messages or stack traces.

**Copybook (if applicable)**
Paste the relevant copybook source, or attach it as a file.

**Environment**
- COBridge version: (e.g. 0.1.0)
- Node.js version: (e.g. 20.11.0)
- Operating system: (e.g. Ubuntu 22.04, Windows 11, macOS 14)
- GnuCOBOL version (if applicable): (e.g. 3.2.0)
```

---

## How to Request Features

We welcome feature requests! Open a [GitHub issue](https://github.com/anthropics/cobridge/issues/new) and describe:

- **What you want**: A clear description of the feature.
- **Why you want it**: The problem this feature would solve or the use case it enables.
- **How you envision it working**: Optional, but helpful. Include API sketches, CLI examples, or diagrams if possible.

---

## Development Setup

### Prerequisites

- [Node.js](https://nodejs.org/) 18 or later
- [GnuCOBOL](https://gnucobol.sourceforge.io/) 3.x (optional, only needed for bridge tests)

### Getting Started

```bash
# Clone the repository
git clone https://github.com/anthropics/cobridge.git
cd cobridge

# Install dependencies
npm install

# Build the project
npm run build

# Run the test suite
npm test
```

### Development Workflow

```bash
# Start the TypeScript compiler in watch mode
npm run dev

# Run tests (in a separate terminal)
npm test

# Try the CLI
node dist/cli/index.js parse ./test-fixtures/CUSTOMER.cpy
```

### Project Structure

```
cobridge/
  src/
    cli/          # Command-line interface
    parser/       # COBOL copybook lexer and parser
    codegen/      # OpenAPI, TypeScript, and JSON Schema generators
    marshal/      # Binary data marshalling (EBCDIC, COMP-3, BINARY)
    bridge/       # GnuCOBOL compilation and invocation
    server/       # Express HTTP server and router
    index.ts      # Main entry point (re-exports all modules)
  tests/          # Test suite
  docs/           # Documentation
  dist/           # Compiled output (generated by npm run build)
```

---

## Code Style

### TypeScript

- **Strict mode**: The project uses TypeScript strict mode. All code must pass `tsc --strict`.
- **ES modules**: Use `.js` extensions in import paths (TypeScript ESM convention):
  ```ts
  // Correct
  import { parseCopybook } from "./parser/parser.js";

  // Incorrect
  import { parseCopybook } from "./parser/parser";
  ```
- **No `any` where avoidable**: Prefer proper types. Use `unknown` when the type is genuinely unknown and narrow it with type guards.
- **Naming conventions**:
  - Functions and variables: `camelCase`
  - Interfaces and classes: `PascalCase`
  - Enums: `PascalCase` with `UPPER_SNAKE_CASE` members
  - Files: `kebab-case.ts`

### Formatting

- 2-space indentation
- No trailing whitespace
- Semicolons required
- Double quotes for strings

### Comments

- Use JSDoc comments (`/** ... */`) for public API functions and types.
- Use inline comments sparingly -- prefer self-documenting code.
- Do not leave commented-out code in the codebase.

---

## Pull Request Process

1. **Fork the repository** and create a feature branch from `main`:
   ```bash
   git checkout -b feature/my-feature
   ```

2. **Make your changes**. Follow the code style guidelines above.

3. **Write or update tests**. Every functional change should include tests. See [Testing Requirements](#testing-requirements) below.

4. **Run the full test suite** and ensure all tests pass:
   ```bash
   npm test
   ```

5. **Build the project** to verify there are no TypeScript errors:
   ```bash
   npm run build
   ```

6. **Commit your changes** with a clear, descriptive commit message:
   ```bash
   git commit -m "Add support for COMP-5 usage type in parser"
   ```

7. **Push your branch** and open a pull request against `main`.

8. **Describe your changes** in the PR description:
   - What does this PR do?
   - Why is this change needed?
   - How was it tested?
   - Any breaking changes?

9. **Respond to review feedback**. We may ask for changes before merging.

---

## Testing Requirements

COBridge has a comprehensive test suite. All contributions must maintain or improve test coverage.

- **All 177 existing tests must pass.** Run `npm test` to verify.
- **New features must include tests.** If you add a new function or feature, add corresponding tests.
- **Bug fixes should include a regression test.** Write a test that fails without your fix and passes with it.
- **Test files** are located in the `tests/` directory, organised by module:
  - `tests/parser.test.ts` -- Parser and lexer tests
  - `tests/marshal.test.ts` -- Marshalling tests (EBCDIC, packed decimal, binary, converter)
  - `tests/codegen.test.ts` -- Code generation tests (OpenAPI, TypeScript, JSON Schema)

### Running Tests

```bash
# Run all tests
npm test

# Run a specific test file
node --loader ts-node/esm tests/parser.test.ts
node --loader ts-node/esm tests/marshal.test.ts
node --loader ts-node/esm tests/codegen.test.ts
```

---

## Documentation Requirements

- **Public API changes must be documented.** If you add or modify a public function, update the relevant documentation in `docs/`.
- **User-facing changes** should include a note in the relevant user guide.
- **Use British English** in all documentation (e.g. "licence" not "license", "colour" not "color", "organisation" not "organization").

---

## Questions?

If you have any questions about contributing, feel free to open a [GitHub issue](https://github.com/anthropics/cobridge/issues) or start a discussion. We are happy to help!
